<html>

<head>
    <title>스마트올 키즈</title>

    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <!-- 검색 엔진에 의해 검색되는 단어를 지정합니다. -->
    <meta name="KeyWORDs" content="" />
    <!-- 검색 결과에 표시되는 문자를 지정합니다. -->
    <meta name="Description" content="" />
    <!-- 검색 로봇 제어 -->
    <meta name="Robots" content="all" />
    <!-- 홈페이지 주제를 지정 -->
    <meta http-equiv="Subject" content="" />
    <!-- 제목을 지정 -->
    <meta http-equiv="Title" content="" />
    <!-- 페이지를 작성한 제작자명을 지정 -->
    <meta http-equiv="Author" content="onflou " />
    <!-- 제작사를 지정 -->
    <meta http-equiv="Publisher" content="" />

    <!-- 브라우저 호환성을 지정 -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge,chorme=1">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../../../COMM/CSS/COMMON.CSS" />
    <link rel="stylesheet" href="../../../COMM/CSS/JQUERY_UI.CSS" />
    <link rel="stylesheet" href="../../../COMM/CSS/STYLE.CSS" />
</head>

<body>
    <div id="wrap" class="">
        <header>
            <div class="indicate">
                <ul class="paging">
                    <li class="page off"><img src="../../COMM/IMG/ICON_CANDY_OFF.PNG"/></li>
                    <li class="page off"><img src="../../COMM/IMG/ICON_CANDY_OFF.PNG"/></li>
                    <li class="page off"><img src="../../COMM/IMG/ICON_CANDY_OFF.PNG"/></li>
                    <li class="page off"><img src="../../COMM/IMG/ICON_CANDY_OFF.PNG"/></li>
                </ul>
            </div>
        </header>

        <div class="wrapper ">
            <div class="zoomInner">
                <section class="section section1">
                    <div class="pageContents">
                        <div id="canvasContainer">                           
                            <canvas id="canvas" class="canvas" width="600" height="600" style="border:solid 3px #CCC;"></canvas>
                            <!-- <canvas id="Jscanvas" class="Jscanvas" width="600" height="600" style="border:solid 3px #CCC;"></canvas> -->
                        </div>
                    </div>
                    <div class="controls">
                        <!--붓의 크기-->
                        <div class="controls__range">
                          <input type="color" id="colorPicker" value="#000000">

                            <input type="range" id="jsRange" min="0.1" max="5.0" step="0.1" />
                        </div>
                        <!--채우기, 저장 버튼-->
                        <!-- <div class="controls__btns">
                            <button id="jsMode">Fill</button>
                            <button id="jsSave">Save</button>
                        </div> -->
                        <!--색상 버튼-->
                        <div class="color-palette">
                            <div class="controls__colors color-items" id="jsColors">
                                <div class="controls__color color-option color-red jsColor" ><img src="../../COMM/IMG/CRAYON_BV.PNG" data-color="#ff0000" alt="랜덤" /></div>
                                <div class="controls__color color-option color-red jsColor" ><img src="../../COMM/IMG/CRAYON_RD.PNG" data-color="#ff0000" alt="빨강" /></div>
                                <div class="controls__color color-option color-orange jsColor" ><img src="../../COMM/IMG/CRAYON_OR.png" data-color="#ff8c00" alt="주황" /></div>
                                <div class="controls__color color-option color-yellow jsColor" ><img src="../../COMM/IMG/CRAYON_YL.png" data-color="#ffff00" alt="노랑" /></div>
                                <div class="controls__color color-option color-green jsColor" ><img src="../../COMM/IMG/CRAYON_GN.png" data-color="#008000" alt="초록" /></div>
                                <div class="controls__color color-option color-blue jsColor" ><img src="../../COMM/IMG/CRAYON_BL.PNG" data-color="#0000ff" alt="파랑" /></div>
                                <div class="controls__color color-option color-purple jsColor" ><img src="../../COMM/IMG/CRAYON_PR.png" data-color="#800080" alt="보라" /></div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="next-btn"> <img src="../../../COMM/IMG/BTN_NEXT_UN.PNG" alt=""> </button>
                    <!-- <button class="done-btn active"> <img src="../../../COMM/IMG/BTN_DONE.PNG" alt=""> </button> -->
                </section>
                <!-- //section1 -->
                
                <section class="section section2">
                    <div class="pageContents">
                        <div class="answer answer11" data-answer=00></div>
                        <div class="answer answer12" data-answer=01></div>
                        <div class="answer answer13" data-answer=02></div>
                        <div class="answer answer14" data-answer=03></div>
                        <img src="../../../COMM/IMG/WORD/1_1/ITEM_1_1.PNG" alt="">
                    </div>
                </section>
                <!-- //section2 -->
            </div>
        </div>
        <!-- <div id="wordWrap"></div> -->
    </div>
    <!-- wrap -->

<SCRIPT SRC="../../../COMM/JS/JQUERY-3.5.1.MIN.JS"></SCRIPT>
<!-- <SCRIPT SRC="../../../COMM/JS/JQUERY_UI.MIN.JS"></SCRIPT> -->
<!-- <SCRIPT SRC="../../../COMM/JS/COMMON.JS"></SCRIPT> -->
<!-- <SCRIPT SRC="../../../COMM/JS/TOUCH.JS"></SCRIPT> -->
<SCRIPT SRC="../../../COMM/JS/FABRIC_S.JS"></SCRIPT>
<script src="../../../COMM/JS/guidelines.js"></script>
<script src="../../../COMM/JS/DATA.JSON"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js"></script> -->

<!-- <SCRIPT SRC="../../../COMM/JS/CONTROLS.JS"></SCRIPT> -->
<script>



/////////////////////////////////////////////////////////////////////////////////////

</script>
  <!-- <script>
    function loadImageAndFill() {
      var canvas = new fabric.Canvas('canvas');

      fabric.Image.fromURL('../../COMM/IMG/WORD/1_1/WORD_1_1_3.PNG', function (img) {
        img.scaleToWidth(canvas.getWidth());
        img.scaleToHeight(canvas.getHeight());
        canvas.add(img);

        canvas.isDrawingMode = true;
        canvas.freeDrawingBrush.width = 10;

        // Get the color picker element
        var colorPicker = document.getElementById('colorPicker');

        // Update the brush color based on the selected color
        colorPicker.addEventListener('input', function () {
          var selectedColor = this.value;
          canvas.freeDrawingBrush.color = selectedColor;
        });

        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
      });
    }

    loadImageAndFill();
</script> -->
<script>
  let _fabricConfig = {
      // ....
      crossOrigin:'anonymous'
  };
  let canvas = this.__canvas = new fabric.Canvas('canvas',_fabricConfig);

    // 캔버스 개발 
    fabric.Object.prototype.objectCaching = false;
    fabric.Object.prototype.targetFindTolerance = 2;
    fabric.Canvas.prototype.orderObjects = function(compare) {
       this._objects.sort(compare);
       this.renderAll();
    }
    
    function stopPainting() {
        painting = false; //그리기를 멈춘다
    }

    function startPainting() {
        painting = true;
    }

    function onMouseMove(event) {
        const x = event.offsetX; //offset은 캔버스만 관계된 좌표
        const y = event.offsetY;
        if (!painting) {
            //그림 그리지 않을때
            ctx.beginPath(); //path(선)의 시작
            ctx.moveTo(x, y); //(보이진 않지만) 이동할때 좌표생성
        } else {
            ctx.lineTo(x, y); //lineTo의 좌표에 path가 그려진다(보이진 않지만)
            ctx.stroke(); //stroke는 path를 선으로 그린다
        } //lineTo와 stroke는 마우스를 움직일때마다 생긴다
    }

    function handleColorClick(event) {
        // const color = event.target.style.backgroundColor;
        $(this).addClass('active');
        $(this).siblings().removeClass('active');
        const color = event.target.dataset.color;
        ctx.strokeStyle = color; //선의 색을 클릭한 색으로 바꾼다
        ctx.fillStyle = ctx.strokeStyle; //채우기 색과  선의 색이 같게 한다
    }
    
    
 
    var w = $('#canvasContainer').width();
    var h = $('#canvasContainer').height();
    let ratio;
    // let center =canvas.getCenter();
    var clipingRect = new fabric.Rect({
        originX: 'center',
        originY: 'center',
        width:600,
        // rx: 100,
        // ry: 100,
        fill:"rgba(255,255,255,0)",
        //strokeDashArray: [5, 5],
        stroke: 10, 
        strokeWidth: 1, 
    });
        
    var mainIMG = new fabric.Image.fromURL('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG', function (objects, options) {
        let objW = objects.width + 36;
        let objH = objects.height + 36;
        ratio = objects.width / objects.height  ;
        objects.set({
            originX: 'center',
            originY: 'center',
            selectable: false,
            preserveObjectStacking:true,
            centeredScaling: true ,
        });
        canvas.add(objects);
        canvas.centerObject(objects);
        canvas.renderAll();
        // updateModifications(true);

        clipingRect.set('width', objW).set('height', objH);
        canvas.centerObject(clipingRect);
    }, { crossOrigin: 'anonymous' });
          
    let bg =  canvas.setBackgroundImage(clipingRect , canvas.renderAll.bind(canvas), {
        originX: 'center',
        originY: 'center',
        // left: center.left,
        // top: center.top,
    });
    
        
    // undo = function undo() {
    //     if (mods+1 < state.length) {
    //         // console.log(mods)
    //         // console.log(state)
    //         canvas.clear().renderAll();
    //         canvas.loadFromJSON(state[state.length - 1 - mods - 1]);
    //         canvas.renderAll();
    //         //console.log("geladen " + (state.length-1-mods-1));
    //         //console.log("state " + state.length);
    //         mods += 1;
    //         //console.log("mods " + mods);
    //     }
    // }
    
    // redo = function redo() {
    //     if (mods > 0) {
    //         canvas.clear().renderAll();
    //         canvas.loadFromJSON(state[state.length - 1 - mods + 1]);
    //         canvas.renderAll();
    //         //console.log("geladen " + (state.length-1-mods+1));
    //         mods -= 1;
    //         //console.log("state " + state.length);
    //         //console.log("mods " + mods);
    //     }
    // }
       


  //  function text(){
  //       var textbox = new fabric.Path('path', {
  //           // left: objleft,
  //           // top: objtop,
  //           fill: 'black',
  //           underline:false,
  //           linethrough: false,
  //           editable: false,
  //           originX: 'center',
  //           originY: 'center',
  //           globalCompositeOperation: 'source-atop'
  //       });
  //       canvas.add(textbox).centerObject(textbox).setActiveObject(textbox);
  //       // updateModifications(true);    
  //   }
  //   text();

   function drawPath(){
        var textbox = new fabric.Canvas('drawing', {
          isDrawingMode: true
        });
        canvas.add(textbox).centerObject(textbox).setActiveObject(textbox);
        // updateModifications(true);    
    }
    drawPath();    
 
    fabric.Object.prototype.transparentCorners = false;
    fabric.Object.prototype.cornerColor = '#A0CEFF';
    fabric.Object.prototype.cornerStrokeColor ="#1A89FF";
    fabric.Object.prototype.borderColor = "#1A89FF";
    fabric.Object.prototype.cornerStyle = 'circle';
    fabric.Object.prototype.cornerSize = "15";
    
    fabric.Object.prototype.setControlsVisibility({
        mt: false, // middle top disable
        mb: false, // midle bottom
        ml: false, // middle left
        mr: false, // I think you get it
    });
    
    function renderIcon(ctx, left, top, styleOverride, fabricObject) {
        var size = this.cornerSize;
        ctx.save();
        ctx.translate(left, top);
        ctx.rotate(fabric.util.degreesToRadians(fabricObject.angle));
        ctx.drawImage(img, -size/2, -size/2, size, size);
        ctx.restore();
      }

    window.addEventListener('resize', resizeCanvas, false);
    function resizeCanvas() {
        var w = $('#canvasContainer').width();
        var h = $('#canvasContainer').height();
        canvas.setDimensions({
            width: w,
            height: h
        });
        
        // canvas.forEachObject(function(obj){
        //     obj.set({
        //         left:(w/2) - (obj.get('left')),
        //         top : (obj.get('top')),
        //     });
        //     obj.setCoords();

        // });
        
        var topimg = canvas.setOverlayImage('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG', canvas.renderAll.bind(canvas), {
            scaleY:0.4,
            scaleX: 0.4,
            originX: 'left',
            originY: 'top',
            left:(w/2) - 141,
            top:(h/2) - 272,
            width:200
        });

            // TEST 떄문에 숨김
            var topimg = canvas.setOverlayImage('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG', function() {
            //canvas.overlayImage && canvas.overlayImage.scaleToWidth(200);
            canvas.centerObject(canvas.overlayImage);
            canvas.renderAll()
        }, {
            // Needed to position overlayImage at 0/0
            originX: 'center',
            originY: 'center',
            crossOrigin: 'anonymous'
        });

        // if(background != undefined ){
        //     canvas.centerObject(background);
        // }
  
      // obj.setCoords();

          canvas.centerObject(clipingRect);
        //  console.log(background.width)

        

    }
    resizeCanvas();
  

</script>
</body>

</html>