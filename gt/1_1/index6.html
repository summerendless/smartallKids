<!DOCTYPE html>
<html>
<head>
  <title>Canvas Image Coloring</title>
</head>
<body>
  <canvas id="canvas"></canvas>
  <input type="color" id="colorPicker">
<SCRIPT SRC="../../../COMM/JS/JQUERY-3.5.1.MIN.JS"></SCRIPT>
<!-- <SCRIPT SRC="../../../COMM/JS/JQUERY_UI.MIN.JS"></SCRIPT> -->
<!-- <SCRIPT SRC="../../../COMM/JS/COMMON.JS"></SCRIPT> -->
<!-- <SCRIPT SRC="../../../COMM/JS/TOUCH.JS"></SCRIPT> -->
<!-- <SCRIPT SRC="../../../COMM/JS/IMAGEFILTER.JS"></SCRIPT> -->
<SCRIPT SRC="../../../COMM/JS/FABRIC_S.JS"></SCRIPT>
<script src="../../../COMM/JS/guidelines.js"></script>
<script src="../../../COMM/JS/DATA.JSON"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>

  <script>
    // 전역 변수
        var isDrawing = false;
    // 이미지 로드 함수
    function loadImage(src, callback) {
      var img = new Image();
      img.onload = function() {
        callback(img);
      };
      img.src = '../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG';
    }
    
 // 초기화 함수
    function initializeCanvas(image) {
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");

        // 캔버스 크기를 이미지와 동일하게 설정
        canvas.width = image.width;
        canvas.height = image.height;

        // 이미지를 캔버스에 그림
        context.drawImage(image, 0, 0, image.width, image.height);

        // 마우스 이벤트 리스너 등록
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseleave", stopDrawing);
    }

    // 그리기 시작
    function startDrawing(e) {
        isDrawing = true;
        colorizeCanvas(e);
    }

    // 그리기 중
    function draw(e) {
        if (isDrawing) {
            colorizeCanvas(e);
        }
    }

    // 그리기 종료
    function stopDrawing() {
        isDrawing = false;
    }
    
    // 색칠 함수
        function colorizeCanvas(e) {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            var colorPicker = document.getElementById("colorPicker");

            // 마우스 좌표 가져오기
            var rect = canvas.getBoundingClientRect();
            var x = e.clientX - rect.left;
            var y = e.clientY - rect.top;

            // 색상 가져오기
            var color = colorPicker.value;

            // 이미지 영역 내에서만 색칠을 적용
            if (x >= 0 && x < canvas.width && y >= 0 && y < canvas.height) {
                floodFill(context, x, y, color);
            }
        }

        // 채우기 알고리즘 (재귀 호출)
        function floodFill(context, x, y, color) {
            // 현재 픽셀 색상 가져오기
            var pixelData = context.getImageData(x, y, 1, 1).data;
            var currentColor = rgbToHex(pixelData[0], pixelData[1], pixelData[2]);

            // 같은 색이면 이미 색칠된 영역이므로 종료
            if (currentColor === color) {
                return;
            }

            // 현재 픽셀에 색상 적용
            context.fillStyle = color;
            context.fillRect(x, y, 1, 1);

            // 상하좌우 픽셀에 대해 재귀적으로 색상 적용
            floodFill(context, x + 1, y, color);
            floodFill(context, x - 1, y, color);
            floodFill(context, x, y + 1, color);
            floodFill(context, x, y - 1, color);
        }

        // RGB 값을 16진수 색상 코드로 변환
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) | (r << 16) | (g << 8) | b).toString(16).slice(1);
        }


    // 16진수 색상을 RGB 값으로 변환하는 함수
    // function hexToR(hex) { return parseInt(hex.slice(1, 3), 16); }
    // function hexToG(hex) { return parseInt(hex.slice(3, 5), 16); }
    // function hexToB(hex) { return parseInt(hex.slice(5, 7), 16); }

    
    // PNG 이미지 로드 및 초기화
    var imageSrc = "path/to/your/image.png";
    loadImage(imageSrc, initializeCanvas);
    
    // 마우스 클릭 이벤트 리스너 등록
    var canvas = document.getElementById("canvas");
    canvas.addEventListener("click", colorizeCanvas);

    // /...

    
    
  </script>
</body>
</html>
