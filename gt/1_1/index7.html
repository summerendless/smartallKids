<!DOCTYPE html>
<html>

    <head>
        <title>Canvas Image Coloring</title>
    </head>

    <body>
        <canvas id="canvas"></canvas>

        <input type="color" id="colorPicker">
        <SCRIPT SRC="../../../COMM/JS/JQUERY-3.5.1.MIN.JS"></SCRIPT>
        <!-- <SCRIPT SRC="../../../COMM/JS/JQUERY_UI.MIN.JS"></SCRIPT> -->
        <!-- <SCRIPT SRC="../../../COMM/JS/COMMON.JS"></SCRIPT> -->
        <!-- <SCRIPT SRC="../../../COMM/JS/TOUCH.JS"></SCRIPT> -->
        <!-- <SCRIPT SRC="../../../COMM/JS/IMAGEFILTER.JS"></SCRIPT> -->
        <SCRIPT SRC="../../../COMM/JS/FABRIC_S.JS"></SCRIPT>
        <script src="../../../COMM/JS/guidelines.js"></script>
        <script src="../../../COMM/JS/DATA.JSON"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.0/fabric.min.js"></script>
<!-- 
        <script>
            var canvas = new fabric.Canvas('canvas');
            var image;

            // 이미지 로드 및 그리기 함수
            function loadImageAndDraw(imageUrl) {
                fabric.Image.fromURL(imageUrl, function (img) {
                    image = img;
                    canvas.setWidth(img.width);
                    canvas.setHeight(img.height);
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
                    enableDrawing();
                });
            }

            // canvas.isDrawingMode = true;
            // canvas.freeDrawingBrush = new fabric.PencilBrush(canvas);
            // canvas.freeDrawingBrush.color = 'red';

            // 그리기 색상 설정 함수
            function setColor(color) {
                canvas.freeDrawingBrush.color = color;
            }

            // 캔버스 초기화 함수
            function clearCanvas() {
                canvas.clear();
                if (image) {
                    canvas.setBackgroundImage(image, canvas.renderAll.bind(canvas));
                }
                enableDrawing();
            }

            // 그리기 작업 활성화 함수
            function enableDrawing() {
                canvas.isDrawingMode = true;
                canvas.on('mouse:move', function (event) {
                    if (canvas.isDrawingMode) {
                        var pointer = canvas.getPointer(event.e);
                        var imageBoundingBox = image.getBoundingRect();
                        if (pointer.x >= imageBoundingBox.left && pointer.x <= imageBoundingBox.left + imageBoundingBox.width &&
                            pointer.y >= imageBoundingBox.top && pointer.y <= imageBoundingBox.top + imageBoundingBox.height) {
                            // 이미지 영역 내에서 그리기 작업을 수행
                            canvas.add(new fabric.Circle({
                                radius: 5,
                                left: pointer.x,
                                top: pointer.y,
                                fill: canvas.freeDrawingBrush.color,
                                selectable: false,
                                evented: false
                            }));
                            canvas.renderAll();
                        }
                    }
                });
            }


            // 이미지 로드 및 그리기 실행
            loadImageAndDraw('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG');
        </script> -->
        <!-- <script>
         var canvas = new fabric.Canvas('canvas');
            var image;

            // 이미지 로드 및 그리기 함수
            function loadImageAndDraw(imageUrl) {
                fabric.Image.fromURL(imageUrl, function (img) {
                    image = img;
                    canvas.setWidth(img.width);
                    canvas.setHeight(img.height);
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
                    enableDrawing();
                });
            }

            // 그리기 색상 설정 함수
            function setColor(color) {
                canvas.freeDrawingBrush.color = color;
            }

            // 캔버스 초기화 함수
            function clearCanvas() {
                canvas.clear();
                if (image) {
                    canvas.setBackgroundImage(image, canvas.renderAll.bind(canvas));
                }
            }

            // 그리기 작업 활성화 함수
            function enableDrawing() {
                canvas.isDrawingMode = true;
                canvas.on('path:created', function (e) {
                    var path = e.path;
                    var pathBoundingBox = path.getBoundingRect();
                    var imageBoundingBox = image.getBoundingRect();

                    // 경로와 이미지 영역의 교차 여부 확인
                    if (pathBoundingBox.left >= imageBoundingBox.left && pathBoundingBox.top >= imageBoundingBox.top &&
                        pathBoundingBox.left + pathBoundingBox.width <= imageBoundingBox.left + imageBoundingBox.width &&
                        pathBoundingBox.top + pathBoundingBox.height <= imageBoundingBox.top + imageBoundingBox.height) {
                        path.globalCompositeOperation = 'source-over';
                    } else {
                        // 경로 삭제하지 않고 영역을 이미지 영역 안으로 제한
                        path.setCoords();
                        if (pathBoundingBox.left < imageBoundingBox.left) {
                            path.setLeft(imageBoundingBox.left);
                        }
                        if (pathBoundingBox.top < imageBoundingBox.top) {
                            path.setTop(imageBoundingBox.top);
                        }
                        if (pathBoundingBox.left + pathBoundingBox.width > imageBoundingBox.left + imageBoundingBox.width) {
                            path.setLeft(imageBoundingBox.left + imageBoundingBox.width - pathBoundingBox.width);
                        }
                        if (pathBoundingBox.top + pathBoundingBox.height > imageBoundingBox.top + imageBoundingBox.height) {
                            path.setTop(imageBoundingBox.top + imageBoundingBox.height - pathBoundingBox.height);
                        }
                        canvas.renderAll();
                    }
                });
            }

            // 이미지 로드 및 그리기 실행
                loadImageAndDraw('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG');
        </script> -->
        
        <script>
             
                var canvas = new fabric.Canvas('canvas',
                        { isDrawingMode: true }
                );
                canvas.freeDrawingBrush.color = 'red'


                fabric.Image.fromURL('../../COMM/IMG/WORD/1_1/WORD_1_1_1.PNG', function(img) {                    
                     img.set({ left: 0, top: 0, scaleX: canvas.width / img.width, scaleY: canvas.height / img.height });

                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));

                    // 이미지 로드 완료 후 clippingRect 설정
                    img.on('loaded', function() {
                        var width = img.width;
                        var height = img.height;
                        
                        canvas.clipTo = function(ctx) {
                        ctx.rect(0, 0, width, height);
                        };
                        
                        canvas.add(img);
                        canvas.renderAll();
                    });
                });

                
        </script>


    </body>

</html>
